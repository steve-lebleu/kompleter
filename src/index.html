<!DOCTYPE html>
<html>

<head lang="en">

    <title>jQuery auto-complete plugin - Kompleter.js</title>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--[if IE]>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <![endif]-->

    <link href='https://fonts.googleapis.com/css?family=Lato|Open+Sans|Montserrat' rel='stylesheet' type='text/css' />
    <link href="css/kompleter.min.css" rel="stylesheet" type="text/css" media="screen" />

    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>-->

    <script src="./js/kompleter.min.js"></script>

</head>

<body>

  <div id="wrapper">
    <input
      type="text"
      name="auto-complete"
      id="auto-complete"
      class="input--search"
      autocomplete="off"
      placeholder="Enter a city name ..."
      value=""
      data-url="files/kompleter.json"
      data-filter-on="Name"
      data-fields="Name,CountryCode,Population" />
  </div>

  <script type="text/javascript">
    function ready(fn) {
      if (document.readyState !== 'loading') {
        fn();
        return;
      }
      document.addEventListener('DOMContentLoaded', fn);
    };
    ready(() => {
      const input = document.getElementById('auto-complete');
      console.log(input);

      const dataSource = {
        url: 'http://localhost:3000/api',
        queryString: {  
          keys: {
            term: 'q',
            limit: 'limit',
            offset: 'offset',
            perPage: 'perPage',
          },
          values: {
            limit: 100,
            offset: 0,
            perPage: 10,
          }
        },
        propertyToValue: null,
      };

      const options = {
        animation: {
          type: 'fadeIn',
          duration: 500
        },
        cache: 5000,
        fieldsToDisplay: [
          'Name',
          'CountryCode',
          'Population'
        ],
      };

      const d = {
        data: [
            {
                "0": "Breda",
                "1": "NLD",
                "2": "160398",
                "Name": "Breda",
                "CountryCode": "NLD",
                "Population": "160398"
            },
            {
                "0": "Tres de Febrero",
                "1": "ARG",
                "2": "352311",
                "Name": "Tres de Febrero",
                "CountryCode": "ARG",
                "Population": "352311"
            },
            {
                "0": "LÂ´Hospitalet de Llobregat",
                "1": "ESP",
                "2": "247986",
                "Name": "LÂ´Hospitalet de Llobregat",
                "CountryCode": "ESP",
                "Population": "247986"
            },
            {
                "0": "Libreville",
                "1": "GAB",
                "2": "419000",
                "Name": "Libreville",
                "CountryCode": "GAB",
                "Population": "419000"
            },
            {
                "0": "Brescia",
                "1": "ITA",
                "2": "191317",
                "Name": "Brescia",
                "CountryCode": "ITA",
                "Population": "191317"
            },
            {
                "0": "Cape Breton",
                "1": "CAN",
                "2": "114733",
                "Name": "Cape Breton",
                "CountryCode": "CAN",
                "Population": "114733"
            },
            {
                "0": "Brest",
                "1": "FRA",
                "2": "149634",
                "Name": "Brest",
                "CountryCode": "FRA",
                "Population": "149634"
            },
            {
                "0": "Bremen",
                "1": "DEU",
                "2": "540330",
                "Name": "Bremen",
                "CountryCode": "DEU",
                "Population": "540330"
            },
            {
                "0": "Freiburg im Breisgau",
                "1": "DEU",
                "2": "202455",
                "Name": "Freiburg im Breisgau",
                "CountryCode": "DEU",
                "Population": "202455"
            },
            {
                "0": "Bremerhaven",
                "1": "DEU",
                "2": "122735",
                "Name": "Bremerhaven",
                "CountryCode": "DEU",
                "Population": "122735"
            },
            {
                "0": "Debrecen",
                "1": "HUN",
                "2": "203648",
                "Name": "Debrecen",
                "CountryCode": "HUN",
                "Population": "203648"
            },
            {
                "0": "Brest",
                "1": "BLR",
                "2": "286000",
                "Name": "Brest",
                "CountryCode": "BLR",
                "Population": "286000"
            }
        ]
      }

      const cbs = {
        onKeyup: (value, cb) => {
          console.log('cb.onKeyup ', value);
          console.log('I\'m doing scrappy stuffs with the data!');
          console.log('You want the data? There is!');
          cb(dataSet);
        },
        onSelect: (value) => {
          console.log('cb.onSelect', value);
        },
        onError: (value) => {
          console.log('cb.onError ', value);
        }
      };

      // Way 1
      input.kompleter(d, options, cbs)
      
      // Way 2
      // kompleter(input, options);

      // Way 3
      // kompleter('auto-complete', options);

    });
  </script>

</body>

</html>
